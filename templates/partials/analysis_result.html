<div class="bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden animate-slide-up">
    <!-- Header -->
    <div class="bg-gradient-to-r from-blue-50 to-purple-50 px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-lg font-semibold text-gray-900">解析結果</h3>
                <p class="text-sm text-gray-600 mt-1">
                    全{{ total_morphemes }}語の形態素を検出しました
                    {% if not sudachi_available %}
                    <span class="inline-flex items-center px-2 py-1 ml-2 text-xs font-medium bg-yellow-100 text-yellow-800 rounded-full">
                        モックデータ
                    </span>
                    {% endif %}
                </p>
            </div>
            <div class="flex items-center space-x-2">
                <button onclick="exportToCSV()" class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                    CSV出力
                </button>
                <button onclick="copyResults()" class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                    コピー
                </button>
            </div>
        </div>
    </div>

    <!-- Results Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200" id="results-table">
            <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">番号</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">表層形</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">辞書形</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">読み</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">品詞</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">品詞詳細1</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">品詞詳細2</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">活用型</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">活用形</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">正規化形</th>
            </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
            {% for result in results %}
            <tr class="hover:bg-gray-50 transition-colors duration-150">
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ loop.index }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-sm font-medium text-gray-900 bg-blue-50 rounded-md">
                            {{ result.surface }}
                        </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {{ result.dictionary_form }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.reading_form }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                            {% if result.pos == '名詞' %}bg-green-100 text-green-800
                            {% elif result.pos == '動詞' %}bg-blue-100 text-blue-800
                            {% elif result.pos == '形容詞' %}bg-purple-100 text-purple-800
                            {% elif result.pos == '副詞' %}bg-yellow-100 text-yellow-800
                            {% elif result.pos == '助詞' %}bg-red-100 text-red-800
                            {% elif result.pos == '助動詞' %}bg-pink-100 text-pink-800
                            {% else %}bg-gray-100 text-gray-800{% endif %}">
                            {{ result.pos }}
                        </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.pos_detail1 if result.pos_detail1 != '*' else '-' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.pos_detail2 if result.pos_detail2 != '*' else '-' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.conjugation_type if result.conjugation_type != '*' else '-' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.conjugation_form if result.conjugation_form != '*' else '-' }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">
                    {{ result.normalized_form }}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

<script>
  // CSV export functionality
  function exportToCSV() {
    const table = document.getElementById('results-table');
    let csv = '';

    // Headers
    const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
    csv += headers.join(',') + '\n';

    // Data rows
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const cells = Array.from(row.querySelectorAll('td')).map(td => {
        let text = td.textContent.trim();
        if (text.includes(',')) {
          text = `"${text}"`;
        }
        return text;
      });
      csv += cells.join(',') + '\n';
    });

    // Download
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `morphological_analysis_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
  }

  // Copy results functionality
  function copyResults() {
    const table = document.getElementById('results-table');
    let text = '';

    // Headers
    const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
    text += headers.join('\t') + '\n';

    // Data rows
    const rows = table.querySelectorAll('tbody tr');
    rows.forEach(row => {
      const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());
      text += cells.join('\t') + '\n';
    });

    navigator.clipboard.writeText(text).then(() => {
      // Show success message
      const button = event.target;
      const originalText = button.textContent;
      button.textContent = 'コピーしました!';
      button.classList.add('bg-green-50', 'text-green-700', 'border-green-300');
      setTimeout(() => {
        button.textContent = originalText;
        button.classList.remove('bg-green-50', 'text-green-700', 'border-green-300');
      }, 2000);
    });
  }
</script>