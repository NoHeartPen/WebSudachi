<div class="card shadow-sm border-0 rounded-3 animate__animated animate__fadeInUp result-card">
    <!-- Header -->
    <div class="card-header bg-gradient border-0 py-4">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h3 class="card-title h4 fw-bold text-dark mb-2">解析結果</h3>
            </div>
            <div class="d-flex gap-2 justify-content-end flex-column flex-md-row">
                <button onclick="exportToCSV()" class="btn btn-outline-primary btn-sm">
                    <i class="bi bi-file-earmark-csv me-1"></i>CSV出力
                </button>
                <button class="btn btn-outline-secondary btn-sm copy-btn">
                    <i class="bi bi-clipboard me-1"></i>コピー
                </button>
            </div>
        </div>
    </div>

    <!-- Results Table -->
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0" id="results-table">
                <thead class="table-light">
                <tr>
                    {% if 'number' in selected_columns %}
                    <th scope="col" class="text-center">番号</th>
                    {% endif %}
                    {% if 'surface' in selected_columns %}
                    <th scope="col" class="results-table-th">表層形</th>
                    {% endif %}
                    {% if 'dictionary_form' in selected_columns %}
                    <th class="results-table-th">辞書形</th>
                    {% endif %}
                    {% if 'reading_form' in selected_columns %}
                    <th class="results-table-th">読み</th>
                    {% endif %}
                    {% if 'pos' in selected_columns %}
                    <th class="results-table-th">品詞</th>
                    {% endif %}
                    {% if 'pos_detail1' in selected_columns %}
                    <th class="results-table-th">品詞詳細1</th>
                    {% endif %}
                    {% if 'pos_detail2' in selected_columns %}
                    <th class="results-table-th">品詞詳細2</th>
                    {% endif %}
                    {% if 'conjugation_type' in selected_columns %}
                    <th class="results-table-th">活用型</th>
                    {% endif %}
                    {% if 'conjugation_form' in selected_columns %}
                    <th class="results-table-th">活用形</th>
                    {% endif %}
                    {% if 'normalized_form' in selected_columns %}
                    <th class="results-table-th">正規化形</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                {% for result in results %}
                <tr>
                    {% if 'number' in selected_columns %}
                    <td class="text-center text-muted fw-bold">
                        {{ loop.index }}
                    </td>
                    {% endif %}
                    {% if 'surface' in selected_columns %}
                    <td>
                        <span class="text-muted">
                            {{ result.surface }}
                        </span>
                    </td>
                    {% endif %}
                    {% if 'dictionary_form' in selected_columns %}
                    <td class="fw-medium text-dark">
                        {{ result.dictionary_form }}
                    </td>
                    {% endif %}
                    {% if 'reading_form' in selected_columns %}
                    <td class="text-muted">
                        {{ result.reading_form }}
                    </td>
                    {% endif %}
                    {% if 'pos' in selected_columns %}
                    <td>
                        <span class="fw-bold
                            {% if result.pos == '名詞' %}text-success
                            {% elif result.pos == '動詞' %}text-primary
                            {% elif result.pos == '形容詞' %}text-info
                            {% elif result.pos == '副詞' %}text-warning
                            {% elif result.pos == '助詞' %}text-danger
                            {% elif result.pos == '助動詞' %}text-secondary
                            {% else %}text-dark{% endif %}">
                            {{ result.pos }}
                        </span>
                    </td>
                    {% endif %}
                    {% if 'pos_detail1' in selected_columns %}
                    <td class="text-muted small">
                        {{ result.pos_detail1 if result.pos_detail1 != '*' else '-' }}
                    </td>
                    {% endif %}
                    {% if 'pos_detail2' in selected_columns %}
                    <td class="text-muted small">
                        {{ result.pos_detail2 if result.pos_detail2 != '*' else '-' }}
                    </td>
                    {% endif %}
                    {% if 'conjugation_type' in selected_columns %}
                    <td class="text-muted small">
                        {{ result.conjugation_type if result.conjugation_type != '*' else '-' }}
                    </td>
                    {% endif %}
                    {% if 'conjugation_form' in selected_columns %}
                    <td class="text-muted small">
                        {{ result.conjugation_form if result.conjugation_form != '*' else '-' }}
                    </td>
                    {% endif %}
                    {% if 'normalized_form' in selected_columns %}
                    <td class="text-muted">
                        {{ result.normalized_form }}
                    </td>
                    {% endif %}
                </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
	// CSV export functionality
	function exportToCSV() {
		const table = document.getElementById('results-table');
		let csv = '';

		// Headers
		const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
		csv += headers.join(',') + '\n';

		// Data rows
		const rows = table.querySelectorAll('tbody tr');
		rows.forEach(row => {
			const cells = Array.from(row.querySelectorAll('td')).map(td => {
				let text = td.textContent.trim();
				if (text.includes(',')) {
					text = `"${text}"`;
				}
				return text;
			});
			csv += cells.join(',') + '\n';
		});

		// Download
		const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
		const link = document.createElement('a');
		link.href = URL.createObjectURL(blob);
		link.download = `morphological_analysis_${new Date().toISOString().split('T')[0]}.csv`;
		link.click();
	}

	// Copy results functionality
	function copyResults() {
		const table = document.getElementById('results-table');
		let text = '';

		// Headers
		const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
		text += headers.join('\t') + '\n';

		// Data rows
		const rows = table.querySelectorAll('tbody tr');
		rows.forEach(row => {
			const cells = Array.from(row.querySelectorAll('td')).map(td => td.textContent.trim());
			text += cells.join('\t') + '\n';
		});

		navigator.clipboard.writeText(text).then(() => {
			// Show success message
			const button = event.target;
			const originalText = button.textContent;
			button.textContent = 'コピーしました!';
			button.classList.add('bg-green-50', 'text-green-700', 'border-green-300');
			setTimeout(() => {
				button.textContent = originalText;
				button.classList.remove('bg-green-50', 'text-green-700', 'border-green-300');
			}, 2000);
		});
	}
</script>

<!-- Custom styles for animations -->
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate__fadeInUp {
        animation: fadeInUp 0.6s ease-out;
    }

    .table th {
        font-weight: 600;
        font-size: 0.875rem;
        letter-spacing: 0.025em;
        text-transform: uppercase;
        border-bottom: 2px solid #dee2e6;
    }

    .table td {
        vertical-align: middle;
        font-size: 0.9rem;
    }

    .badge.rounded-pill {
        font-size: 0.775em;
        padding: 0.4em 0.8em;
    }

    .btn-group .btn {
        font-size: 0.875rem;
        padding: 0.5rem 1rem;
        font-weight: 500;
    }

    .card-header {
        border-bottom: 1px solid rgba(0,0,0,0.05);
        background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
    }

    .table-hover tbody tr:hover {
        background-color: rgba(0,0,0,0.025);
    }

    /* Responsive improvements */
    @media (max-width: 768px) {
        .btn-group {
            flex-direction: column;
            width: 100%;
        }

        .btn-group .btn {
            border-radius: 0.375rem !important;
            margin-bottom: 0.25rem;
        }

        .d-flex.justify-content-between {
            flex-direction: column;
            gap: 1rem;
        }

        .table-responsive {
            font-size: 0.8rem;
        }
    }

    /* Print styles */
    @media print {
        .btn-group {
            display: none !important;
        }

        .card {
            border: none !important;
            box-shadow: none !important;
        }
    }

    .th-width{
        width: 120px;
    }

    .result-card{
        border-radius: 12px;
    }
</style>
